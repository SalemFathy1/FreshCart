<section class="py-3">
  <div class="container">
    <div class="bread-crumb mb-3">
      <p class="m-0 d-flex gap-3">
        <a routerLink="/home" class="text-main"><i class="fa fa-home"></i></a> /
        <a routerLink="/shop" class="text-main">Shop</a> /
        <a>My Orders</a>
      </p>
    </div>
  </div>
</section>
<section class="p-0 mb-5">
  <div class="container">
    <div class="header mb-5">
      <h1 class="section-title mb-2">My Orders</h1>
      <p class="text-secondary fw-medium">All Orders info here !</p>
    </div>

    <div class="orders-info">
      <div class="row g-4 mb-4">
        <!-- Added gutter between cards -->
        <!-- All Orders Card -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm p-4 hover-effect">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="m-0 text-primary">All Orders</h3>
              <div class="icon-wrapper bg-primary-light">
                <i class="pi pi-shopping-bag text-primary"></i>
              </div>
            </div>
            <div class="d-flex align-items-end">
              <h2 class="m-0 display-6 fw-bold">{{ allOrdersNumber }}</h2>
              <span class="ms-2 text-main small">
                <i class="pi pi-arrow-up"></i> 12% from last month
              </span>
            </div>
          </div>
        </div>

        <!-- Completed Orders Card -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm p-4 hover-effect">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="m-0 text-main">Completed</h3>
              <div class="icon-wrapper bg-success-light">
                <i class="pi pi-check-circle text-success"></i>
              </div>
            </div>
            <div class="d-flex align-items-end">
              <h2 class="m-0 display-6 fw-bold">
                {{ myCompletedOrders.length }}
              </h2>
              <span class="ms-2 text-main small">
                <i class="pi pi-arrow-up"></i> 8% from last month
              </span>
            </div>
          </div>
        </div>

        <!-- Pending Orders Card -->
        <div class="col-md-4">
          <div class="card h-100 shadow-sm p-4 hover-effect">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="m-0 text-warning">Pending</h3>
              <div class="icon-wrapper bg-warning-light">
                <i class="pi pi-clock text-warning"></i>
              </div>
            </div>
            <div class="d-flex align-items-end">
              <h2 class="m-0 display-6 fw-bold">{{ pendingOrders.length }}</h2>
              <span class="ms-2 text-danger small">
                <i class="pi pi-arrow-down"></i> 3% from last month
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="orders-nav mb-3">
        <ul class="list-unstyled d-flex gap-3 border-bottom">
          <li
            (click)="filterOrders('all')"
            [ngClass]="{ active: active == 'all' }"
            class="p-3"
          >
            <a>All orders</a>
          </li>
          <li
            (click)="filterOrders('completed')"
            [ngClass]="{ active: active == 'completed' }"
            class="p-3 active-link"
          >
            <a>Completed</a>
          </li>
          <li
            (click)="filterOrders('pending')"
            [ngClass]="{ active: active == 'pending' }"
            class="p-3"
          >
            <a>Pending</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="row g-3">
      @for (order of myOrders; track order.id) {
      <div class="col-12">
        <div class="order p-4">
            <div class="order-shape">
                <img src="../../../assets/images/8882807.jpg" alt="">
            </div>
          <div class="order-haeder d-flex justify-content-between">
            <div class="order-id">
              <span
                >Order ID : <strong class="text-main">#{{ $index + 1 }}</strong>
              </span>
            </div>
            <div class="order-states d-flex gap-2 align-items-center">
              @if(order.isPaid){
              <p
                class="text-success bg-success-subtle px-2 py-1 rounded-3 d-flex align-items-center gap-1"
              >
                Paid
              </p>
              }@else{
              <p
                class="text-danger bg-danger-subtle px-2 py-1 rounded-3 d-flex align-items-center gap-1"
              >
                Not Paid
              </p>
              } @if(order.isDelivered){
              <p
                class="text-success bg-success-subtle px-2 py-1 rounded-3 d-flex align-items-center gap-1"
              >
                Delivered
              </p>

              }@else{
              <p
                class="text-warning bg-warning-subtle px-2 py-1 rounded-3 d-flex align-items-center gap-1"
              >
                Not Delivered
              </p>

              } @if(order.paymentMethodType == 'card'){
              <p
                class="text-success bg-success-subtle px-2 py-1 rounded-3 d-flex align-items-center gap-1"
              >
                Card Pay <i class="pi pi-credit-card"></i>
              </p>

              }@else if(order.paymentMethodType == 'cash'){
              <p
                class="text-success bg-success-subtle px-2 py-1 rounded-3 d-flex align-items-center gap-1"
              >
                Cash Pay <i class="pi pi-wallet"></i>
              </p>

              }
            </div>
          </div>
          <div class="order-body">
            <div class="address-details mb-3">
              <p>
                To : <strong>{{ order.shippingAddress.city }}</strong>
              </p>
              <p>
                Phone : <strong>{{ order.shippingAddress.phone }}</strong>
              </p>
              <p>
                email : <strong>{{ order.user.email }}</strong>
              </p>
              <p>
                Total Price :
                <strong>{{ order.totalOrderPrice | currency }}</strong>
              </p>
              <p>
                Order items count :
                <strong>{{ order.cartItems.length }}</strong>
              </p>
            </div>
            <div class="show-items">
              <button (click)="toggleDialog(order.id)" class="btn-main">
                Show Order Items
              </button>
            </div>
          </div>
        </div>
      </div>
      <p-dialog
        header="Order #{{$index + 1}} Details"
        [(visible)]="dialogVisibility[order.id]"
        [modal]="true"
        [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
        [style]="{ width: '50vw' }"
        [draggable]="false"
        [resizable]="false"
      >
      <div class="order-details">
        <div class="order-header mb-4">
          <div class="d-flex flex-wrap gap-3 mb-3">
            <div class="badge bg-primary-subtle text-primary p-2">
              <i class="pi pi-calendar me-2"></i>
              {{order.createdAt | date:'mediumDate'}}
            </div>
            <div class="badge bg-success-subtle text-success p-2">
              <i class="pi pi-dollar me-2"></i>
              Total: {{order.totalOrderPrice | currency:'USD'}}
            </div>
          </div>
        </div>
      
        <div class="order-items">
          <div class="table-responsive border rounded overflow-hidden">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th style="width: 60px"></th>
                  <th>Product</th>
                  <th class="text-center">Qty</th>
                  <th class="text-end">Price</th>
                </tr>
              </thead>
              <tbody>
                @for (item of order.cartItems; track item.product.id) {
                <tr>
                  <td>
                    <img [src]="item.product.imageCover" 
                         [alt]="item.product.title"
                         class="img-thumbnail rounded-2"
                         style="width: 50px; height: 50px; object-fit: cover;">
                  </td>
                  <td>
                    <h6 class="mb-1 fw-semibold">{{item.product.title}}</h6>
                    <small class="text-muted">{{item.product.category.name}}</small>
                  </td>
                  <td class="text-center">
                    <span class="badge bg-light text-dark border p-2">
                      {{item.count}}
                    </span>
                  </td>
                  <td class="text-end fw-bold">
                    {{item.price * item.count | currency:'USD'}}
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      
        <div class="order-summary mt-4 p-3 bg-light rounded">
          <div class="row">
            <div class="col-md-6 mb-3">
              <h6 class="fw-bold">Shipping Address</h6>
              <div class="text-muted">
                <p class="mb-1">{{order.shippingAddress.city}}</p>
                <p class="mb-1">{{order.shippingAddress.phone}}</p>
                <p>{{order.user.email}}</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex justify-content-between mb-2">
                <span>Subtotal:</span>
                <span>{{order.totalOrderPrice | currency:'USD'}}</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>Shipping:</span>
                <span>Free</span>
              </div>
              <div class="d-flex justify-content-between fw-bold fs-5">
                <span>Total:</span>
                <span>{{order.totalOrderPrice | currency:'USD'}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      </p-dialog>
      }
    </div>
  </div>
</section>
